<p-card>
  <div class="header-section">
    <button pButton 
            icon="pi pi-arrow-right" 
            class="p-button-text back-button" 
            (click)="goBack()">
    </button>
    <h2>استلام المواد</h2>
  </div>


  <div class="orders-list" *ngIf="!loading && !materialOrder">
    <p-table [value]="materialOrder" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th>رقم أمر الشراء</th>
          <th>المورد</th>
          <th>تاريخ التسليم</th>
          <th>التكلفة الإجمالية</th>
          <th>الحالة</th>
          <th>الإجراءات</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-order>
        <tr>
          <td>{{order.purchase_number}}</td>
          <td>{{order.supplier?.name}}</td>
          <td>{{order.delivery_date | date}}</td>
          <td>{{order.total_cost | currency:'SAR'}}</td>
          <td>
            <p-tag [severity]="'success'" value="{{order.status_display}}"></p-tag>
          </td>
          <td>
            <button pButton icon="pi pi-eye" 
                    class="p-button-rounded p-button-info"
                    (click)="viewOrderDetails(order.id)">
            </button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">لا توجد طلبات معتمدة</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Order Details View -->
  <div class="order-details" *ngIf="!loading && materialOrder">
    <div class="grid">
      <div class="col-12 md:col-6">
        <div class="field">
          <label>رقم الطلب</label>
          <div>{{materialOrder.purchase_number}}</div>
        </div>
        <div class="field">
          <label>المورد</label>
          <div>{{materialOrder.supplier?.name}}</div>
        </div>
        <div class="field">
          <label>الحالة</label>
          <p-tag [severity]="'success'" [value]="materialOrder.status_display"></p-tag>
        </div>
      </div>
      <div class="col-12 md:col-6">
        <div class="field">
          <label>تاريخ الإنشاء</label>
          <div>{{materialOrder.created_at | date}}</div>
        </div>
        <div class="field">
          <label>المبلغ الإجمالي</label>
          <div>{{materialOrder.total_cost | currency:'SAR'}}</div>
        </div>
      </div>
    </div>

    <div class="materials-table mt-4">
      <h3>المواد المطلوبة</h3>
      <p-table [value]="materialOrder.raw_materials">
        <ng-template pTemplate="header">
          <tr>
            <th>المادة</th>
            <th>الكمية</th>
            <th>سعر الوحدة</th>
            <th>الإجمالي</th>
            <th>حالة التسليم</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>{{item.raw_material.name}}</td>
            <td>{{item.quantity}}</td>
            <td>{{item.unit_price | currency:'SAR'}}</td>
            <td>{{item.quantity * item.unit_price | currency:'SAR'}}</td>
            <td>
              <p-tag [severity]="item.is_delivered ? 'success' : 'warn'"
                     [value]="item.delivery_status_display">
              </p-tag>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</p-card>
